{% extends "base.html" %}
{% load static %}

{% block title %} | {{ user.first_name }}{% endblock %}

{% block nav %}
<li class="nav-item">
  <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">–ü—Ä–∏–≤–µ—Ç {{ user.first_name }}!</a>
</li>
{% endblock %}

{% block endnav %}
<a href="/logout/"><button class="btn btn-outline-dark my-2 my-sm-0">–í—ã–π—Ç–∏</button></a>
{% endblock %}

{% block content %}
{% if messages %}
<ul>
  {% for message in messages %}
  <div class="alert alert-danger" role="alert">
    {{ message }}
  </div>
  {% endfor %}
</ul>
{% endif %}
<div class="row">
  <div class="col-3">
    <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
      <a class="nav-link" id="tokens-tab" data-toggle="pill" href="#tokens" role="tab" aria-controls="tokens" aria-selected="false">–¢–æ–∫–µ–Ω—ã</a>
      <a class="nav-link active" id="requests-tab" data-toggle="pill" href="#requests" role="tab" aria-controls="requests" aria-selected="true">–ó–∞–ø—Ä–æ—Å—ã</a>
      <a class="nav-link" id="settins-tab" data-toggle="pill" href="#settings" role="tab" aria-controls="settings" aria-selected="false">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a>
      <a class="nav-link" id="makerequest-tab" data-toggle="pill" href="#makerequest" role="tab" aria-controls="makerequest" aria-selected="false">–°–¥–µ–ª–∞—Ç—å –ó–∞–ø—Ä–æ—Å</a>
      <a class="nav-link" id="proxy-tab" data-toggle="pill" href="#proxy" role="tab" aria-controls="proxy" aria-selected="false">–ü—Ä–æ–∫—Å–∏</a>
    </div>
  </div>
  <div class="col-9">
    <div class="tab-content" id="v-pills-tabContent">
      <div class="tab-pane fade" id="tokens" role="tabpanel" aria-labelledby="tokens-tab">
        <button type="button" class="btn btn-secondary btn-md btn-block" data-toggle="modal" data-target="#addtokenform">–î–æ–±–∞–≤–∏—Ç—å –¢–æ–∫–µ–Ω</button>

        <div class="modal fade" id="addtokenform" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form method="post" action="/addtoken/">
        {% csrf_token %}
      <div class="modal-body">
         <div class="form-group">
    <label for="tokenname">–ò–º—è —Ç–æ–∫–µ–Ω–∞</label>
    <input type="text" name="name" class="form-control" id="tokentext" aria-describedby="tokentextd">
    <small id="tokentextd" class="form-text text-muted">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ –ø–æ–ª–µ, —á—Ç–æ–±—ã –≤–µ—Å—Ç–∏ —É—á–µ—Ç –≤–∞—à–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤</small>
  </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
        <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
      </div>
      </form>
    </div>
  </div>
</div>

        <br>
        {% if tokens_null %}
        <h3>–£ –≤–∞—Å –Ω–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤, —Å–æ–∑–¥–∞–π—Ç–µ –æ–¥–∏–Ω üëÜ</h3>
        {% else %}
        {% for i in tokens %}
        <div class="card shadow {% if i.is_valid %}border-success{% else %}border-danger{% endif %}">
          <div class="card-header"><b>{{ i.name }}</b> - {% if i.is_valid %}–í–∞–ª–∏–¥–Ω—ã–π{% else %}–ù–µ–≤–∞–ª–∏–¥–Ω—ã–π{% endif %}</div>
          <ul class="list-group list-group-flush">
            <li class="list-group-item">
              <code>{{ i.token }}</code>
            </li>
            <li class="list-group-item">
              –ë—ã–ª —Å–æ–∑–¥–∞–Ω {{ i.date }}
            </li>
            <li class="list-group-item">
              <a href="removetoken?token={{ i.token }}" class="btn btn-primary btn-block">–£–¥–∞–ª–∏—Ç—å</a>
            </li>
          </ul>
        </div>
        <br>
        {% endfor %}
        {% endif %}
      </div>
      <div class="tab-pane fade show active" id="requests" role="tabpanel" aria-labelledby="requests-tab">
        {% if requests_null %}
        <h3>–í—ã –Ω–µ —Å–¥–µ–ª–∞–ª–∏ –µ—â–µ –Ω–∏ –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞. <a href="#makerequest"  data-toggle="pill" role="tab" aria-controls="makerequest">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ!</a></h3>
        {% else %}
        {% for i in req %}
        <div class="shadow accordion" id="accordion{{ i.task }}">
          <div class="card">
            <div class="card-header">{{ i.date }}{% if i.is_done is 100 %} - –í—ã–ø–æ–ª–Ω–µ–Ω{% endif %} <a class="btn btn-outline-danger" href="/removereq?req={{ i.task }}">–£–¥–∞–ª–∏—Ç—å</a> {% if i.is_done is not 0 %}<a class="btn btn-outline-secondary" href="/downloadcsv?task={{ i.task }}">–°–∫–∞—á–∞—Ç—å CSV</a>{% endif %}</div> 
              <div class="card-body">
              <ul class="list-group list-group-flush">
                <li class="list-group-item">
                  TASK ID - <code>{{ i.task }}</code>
                  <br>
                  –í –∑–∞–ø—Ä–æ—Å–µ {% if i.is_id %}–∞–π–¥–∏—à–Ω–∏–∫–∏{% else %}—é–∑–µ—Ä–Ω–µ–π–º—ã{% endif %}
              </ul>
            </div>
          </div>
          <div class="card">
            <div class="card-header" id="heading{{ i.task }}">
              <h2 class="mb-0">
                <button class="btn btn-link btn-block text-left" type="button" data-toggle="collapse" data-target="#collapse{{ i.task }}" aria-expanded="false" aria-controls="collapse{{ i.task }}">
                  –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∑–∞–ø—Ä–æ—Å–∞
                </button>
              </h2>
            </div>
            <div id="collapse{{ i.task }}" class="collapse" aria-labelledby="heading{{ i.task }}" data-parent="#accordion{{ i.task }}">
              <div class="card-body">
                <pre>{{ i.data|safe }}</pre>
              </div>
            </div>
          </div>
          <div class="card">
            {% if i.is_done is not 0 %}
            <div class="card-header" id="heading{{ i.task }}2">
              <h2 class="mb-0">
                <button class="btn btn-link btn-block text-left" type="button" data-toggle="collapse" data-target="#collapse{{ i.task }}2" aria-expanded="false" aria-controls="collapse{{ i.task }}2">
                  –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ—Ç–≤–µ—Ç–∞
              </h2>
            </div>
            <div id="collapse{{ i.task }}2" class="collapse" aria-labelledby="heading{{ i.task }}2" data-parent="#accordion{{ i.task }}">
              <div class="card-body">
                <pre>{{ i.response|safe }}</pre>
              </div>
            </div>
            {% else %}
            <div class="card-body">
              –û—Ç–≤–µ—Ç –µ—â–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω, –æ–∂–∏–¥–∞–π—Ç–µ.
            </div>
            {% endif %}
          </div>
           {% if i.is_done is not 0 and i.is_done is not 100 %}
            <div class="progress" style="height: 20px;">
              <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: {{ i.is_done }}%" aria-valuenow="{{ i.is_done }}" aria-valuemin="0" aria-valuemax="100">–ò–¥–µ—Ç –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ {{ i.is_done }}%</div>
          </div>
          {% endif %}
        </div>
      
        <br>
        {% endfor %}
        {% endif %}

      </div>
      <div class="tab-pane fade" id="settings" role="tabpanel" aria-labelledby="settings-tab">
       <h1>–ü—Ä–æ—Ñ–∏–ª—å</h1>
<p></p>
<form method="POST" name="privdata">
  {% csrf_token %}
  <div class="input-group">
    <div class="input-group-prepend">
      <span class="input-group-text">–ò–º—è –∏ –§–∞–º–∏–ª–∏—è</span>
    </div>
    <input required name="FirstName" type="text" aria-label="First name" class="form-control" value="{{ user.first_name }}" placeholder="–°–º–µ–Ω–∏–≤—à–∏–π –ò–º—è">
    <input name="LastName" type="text" aria-label="Last name" class="form-control" value="{{ user.last_name }}" placeholder="–°–º–µ–Ω–∏–≤—à–∏–π –§–∞–º–∏–ª–∏—é">
  </div>
  <p></p>
  <div class="input-group mb-3">
    <div class="input-group-prepend">
      <span class="input-group-text" id="basic-addon1">–ò–º—è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</span>
    </div>
    <input required name="username" type="text" class="form-control" placeholder="__nick_changer__" aria-label="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" aria-describedby="basic-addon1" value="{{ user.username }}">
  </div>
  <p></p>
  <div class="input-group mb-3">
    <div class="input-group-prepend">
      <span class="input-group-text" id="basic-addon1">Email</span>
    </div>
    <input required name="email" type="text" class="form-control" placeholder="mailer@inspiper.ru" aria-label="email" aria-describedby="basic-addon1" value="{{ user.email }}">
  </div>
  <p></p>
  <div class="form-group">
    <input name="pdatasubm" type="submit" class="form-control" id="exampleInputEmail1" aria-describedby="submitHelp" value="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å">
  </div>
</form>
<p></p>
<p>–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ä–∞–∑ –≤—ã –∑–∞—Ö–æ–¥–∏–ª–∏ {{ user.last_login }}</p>
      </div>
      <div class="tab-pane fade" id="makerequest" role="tabpanel" aria-labelledby="makerequest-tab">
        {% if req_tokens_null %}
        <h3>–£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤. <a href="#tokens">–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω</a> –∏ –ø—Ä–æ–π–¥–∏—Ç–µ –≤–∞–ª–∏–¥–∞—Ü–∏—é.</h3>
        {% else %}
        <h1>–ù–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å.</h1>
        <br>
        <form method="post" name="makerequest" enctype="multipart/form-data">
          {% csrf_token %}
          <div class="input-group mb-3">
            <div class="input-group-prepend">
              <label class="input-group-text" for="inputGroupSelect01">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–∫–µ–Ω</label>
            </div>
            <select class="custom-select" id="inputGroupSelect01" name="token">
              <option disabled>–í—ã–±–µ—Ä–∏—Ç–µ –¢–æ–∫–µ–Ω</option>
              {% for i in req_tokens %}
              <option>{{ i.token }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="form-group">
            <label for="exampleFormControlTextarea1">–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –ø—Ä–æ –≤–≤–æ–¥–µ –∏–∑ —Ñ–∞–π–ª–∞</label>
            <textarea class="form-control" id="exampleFormControlTextarea1" name="data"></textarea>
          </div>
          <div class="input-group mb-3">
            <div class="input-group-prepend">
              <span class="input-group-text" id="inputGroupFileAddon01">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è</span>
            </div>
            <div class="custom-file">
              <input name="datafileinput" type="file" class="custom-file-input" id="inputGroupFile01" aria-describedby="inputGroupFileAddon01">
              <label class="custom-file-label" for="inputGroupFile01">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª</label>
            </div>
          </div>
          <fieldset class="form-group">
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="datatype" id="inlineRadio1" value="usernames">
              <label class="form-check-label" for="inlineRadio1">–≠—Ç–æ —é–∑–µ—Ä–Ω–µ–π–º—ã</label>
            </div>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="radio" name="datatype" id="inlineRadio2" value="ids">
              <label class="form-check-label" for="inlineRadio2">–≠—Ç–æ –∞–π–¥–∏—à–Ω–∏–∫–∏</label>
            </div>
          </fieldset>
          {% if not proxy_null %}
          <div class="input-group mb-3">
            <div class="input-group-prepend">
              <label class="input-group-text" for="inputGroupSelect01">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–∫—Å–∏ –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∏–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –Ω–∏–∂–µ</label>
            </div>
            <select name="proxysaved" class="custom-select" id="inputGroupSelect01">
              <option value="none" selected>–í–≤–µ–¥—É –Ω–∏–∂–µ</option>
              {% for i in proxy %}
              <option value="{{ i.id }}">{{ i.name }}</option>
              {% endfor %}
            </select>
          </div>
          {% endif %}
          <div class="form-group">
            <label for="exampleFormControlTextarea1">–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–∫—Å–∏ –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –ø—Ä–æ –≤–≤–æ–¥–µ –∏–∑ —Ñ–∞–π–ª–∞ –∏–ª–∏ –≤—ã–±–æ—Ä–µ –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö</label>
            <textarea class="form-control" id="exampleFormControlTextarea1" name="proxy"></textarea>
          </div>
          <div class="input-group mb-3">
            <div class="input-group-prepend">
              <span class="input-group-text" id="inputGroupFileAddon01">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ —Å –ø—Ä–æ–∫—Å–∏</span>
            </div>
            <div class="custom-file">
              <input name="proxyfileinput" type="file" class="custom-file-input" id="inputGroupFile01" aria-describedby="inputGroupFileAddon01">
              <label class="custom-file-label" for="inputGroupFile01">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª</label>
            </div>
          </div>

          <input class="btn btn-dark btn-md btn-block" name="makerequest" value="–°–¥–µ–ª–∞—Ç—å –ó–∞–ø—Ä–æ—Å" type="submit">
        </form>
        {% endif %}
      </div>
      <div class="tab-pane fade" id="proxy" role="tabpanel" aria-labelledby="proxy-tab">
        <button type="button" class="btn btn-secondary btn-md btn-block" data-toggle="modal" data-target="#addproxy">–î–æ–±–∞–≤–∏—Ç—å –ü—Ä–æ–∫—Å–∏</button>

        <div class="modal fade" id="addproxy" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–∫—Å–∏</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form method="post" action="/addproxy/" enctype="multipart/form-data">
        {% csrf_token %}
      <div class="modal-body">
         <div class="form-group">
    <label for="tokenname">–ò–º—è –ø—Ä–æ–∫—Å–∏</label>
    <input type="text" name="name" class="form-control" id="tokentext" aria-describedby="tokentextd">
    <small id="tokentextd" class="form-text text-muted">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ –ø–æ–ª–µ, —á—Ç–æ–±—ã –≤–µ—Å—Ç–∏ —É—á–µ—Ç –≤–∞—à–∏—Ö –ø—Ä–æ–∫—Å–∏</small>
  </div>
<div class="form-group">
            <label for="exampleFormControlTextarea1">–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–∫—Å–∏ –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –ø—Ä–æ –≤–≤–æ–¥–µ –∏–∑ —Ñ–∞–π–ª–∞</label>
            <textarea class="form-control" id="exampleFormControlTextarea1" name="proxy"></textarea>
          </div>
          <div class="input-group mb-3">
            <div class="input-group-prepend">
              <span class="input-group-text" id="inputGroupFileAddon01">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ —Å –ø—Ä–æ–∫—Å–∏</span>
            </div>
            <div class="custom-file">
              <input name="proxyfileinput" type="file" class="custom-file-input" id="inputGroupFile01" aria-describedby="inputGroupFileAddon01">
              <label class="custom-file-label" for="inputGroupFile01">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª</label>
            </div>
          </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
        <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å</button>
      </div>
      </form>
    </div>
  </div>
</div>
<br>

        {% if proxy_null %}
        <h1>–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–æ–∫—Å–∏</h1>
        {% else %}
        {% for i in proxy %}
        <div class="shadow accordion" id="accordion{{ i.id }}">
          <div class="card">
            <div class="card-header">
              <b>{{ i.name }}</b> {{ i.date }} 
              <button type="button" class="btn btn-outline-secondary" data-toggle="modal" data-target="#renameproxy{{ i.id }}">
                –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å
              </button>
              <div class="modal fade" id="renameproxy{{ i.id }}" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="staticBackdropLabel" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="staticBackdropLabel">–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –ø—Ä–æ–∫—Å–∏ "{{ i.name }}"</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <form method="post" action="/renameproxy/">
                    {% csrf_token %}
                  <div class="modal-body">
                     <div class="form-group">
                      <label for="tokenname">–ò–º—è –ø—Ä–æ–∫—Å–∏</label>
                      <input type="text" name="name" class="form-control" id="tokentext" aria-describedby="tokentextd">
                      <small id="tokentextd" class="form-text text-muted">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ –ø–æ–ª–µ, —á—Ç–æ–±—ã –≤–µ—Å—Ç–∏ —É—á–µ—Ç –≤–∞—à–∏—Ö –ø—Ä–æ–∫—Å–∏</small>
                    </div>
                    <input type="hidden" name="id" value="{{ i.id }}"/>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn btn-primary">–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å</button>
                  </div>
                  </form>
                </div>
              </div>
            </div>
              <a class="btn btn-outline-danger" href="/removeproxy?id={{ i.id }}">–£–¥–∞–ª–∏—Ç—å</a> 
            </div>
          </div>
          <div class="card">
            <div class="card-header" id="heading{{ i.id }}">
              <h2 class="mb-0">
                <button class="btn btn-link btn-block text-left" type="button" data-toggle="collapse" data-target="#collapse{{ i.id }}" aria-expanded="false" aria-controls="collapse{{ i.id }}">
                  –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
                </button>
              </h2>
            </div>
            <div id="collapse{{ i.id }}" class="collapse" aria-labelledby="heading{{ i.id }}" data-parent="#accordion{{ i.id }}">
              <div class="card-body">
                <pre>{{ i.proxy|safe }}</pre>
              </div>
            </div>
          </div>

        </div>
        <br>
        {% endfor %}
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
